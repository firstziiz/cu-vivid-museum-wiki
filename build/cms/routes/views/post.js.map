{"version":3,"sources":["../../../../src/cms/routes/views/post.js"],"names":["keystone","require","exports","module","req","res","view","View","locals","section","filters","post","params","data","posts","on","next","q","list","model","findOne","state","slug","populate","exec","err","result","find","where","sort","limit","results","render"],"mappings":";;AAAA,IAAIA,WAAWC,QAAQ,UAAR,CAAf;;AAEAC,UAAUC,OAAOD,OAAP,GAAiB,UAAUE,GAAV,EAAeC,GAAf,EAAoB;;AAE9C,KAAIC,OAAO,IAAIN,SAASO,IAAb,CAAkBH,GAAlB,EAAuBC,GAAvB,CAAX;AACA,KAAIG,SAASH,IAAIG,MAAjB;;AAEA;AACAA,QAAOC,OAAP,GAAiB,MAAjB;AACAD,QAAOE,OAAP,GAAiB;AAChBC,QAAMP,IAAIQ,MAAJ,CAAWD;AADD,EAAjB;AAGAH,QAAOK,IAAP,GAAc;AACbC,SAAO;AADM,EAAd;;AAIA;AACAR,MAAKS,EAAL,CAAQ,MAAR,EAAgB,UAAUC,IAAV,EAAgB;;AAE/B,MAAIC,IAAIjB,SAASkB,IAAT,CAAc,MAAd,EAAsBC,KAAtB,CAA4BC,OAA5B,CAAoC;AAC3CC,UAAO,WADoC;AAE3CC,SAAMd,OAAOE,OAAP,CAAeC;AAFsB,GAApC,EAGLY,QAHK,CAGI,mBAHJ,CAAR;;AAKAN,IAAEO,IAAF,CAAO,UAAUC,GAAV,EAAeC,MAAf,EAAuB;AAC7BlB,UAAOK,IAAP,CAAYF,IAAZ,GAAmBe,MAAnB;AACAV,QAAKS,GAAL;AACA,GAHD;AAKA,EAZD;;AAcA;AACAnB,MAAKS,EAAL,CAAQ,MAAR,EAAgB,UAAUC,IAAV,EAAgB;;AAE/B,MAAIC,IAAIjB,SAASkB,IAAT,CAAc,MAAd,EAAsBC,KAAtB,CAA4BQ,IAA5B,GAAmCC,KAAnC,CAAyC,OAAzC,EAAkD,WAAlD,EAA+DC,IAA/D,CAAoE,gBAApE,EAAsFN,QAAtF,CAA+F,QAA/F,EAAyGO,KAAzG,CAA+G,GAA/G,CAAR;;AAEAb,IAAEO,IAAF,CAAO,UAAUC,GAAV,EAAeM,OAAf,EAAwB;AAC9BvB,UAAOK,IAAP,CAAYC,KAAZ,GAAoBiB,OAApB;AACAf,QAAKS,GAAL;AACA,GAHD;AAKA,EATD;;AAWA;AACAnB,MAAK0B,MAAL,CAAY,MAAZ;AACA,CA3CD","file":"post.js","sourcesContent":["var keystone = require('keystone');\n\nexports = module.exports = function (req, res) {\n\n\tvar view = new keystone.View(req, res);\n\tvar locals = res.locals;\n\n\t// Set locals\n\tlocals.section = 'blog';\n\tlocals.filters = {\n\t\tpost: req.params.post,\n\t};\n\tlocals.data = {\n\t\tposts: [],\n\t};\n\n\t// Load the current post\n\tview.on('init', function (next) {\n\n\t\tvar q = keystone.list('Post').model.findOne({\n\t\t\tstate: 'published',\n\t\t\tslug: locals.filters.post,\n\t\t}).populate('author categories');\n\n\t\tq.exec(function (err, result) {\n\t\t\tlocals.data.post = result;\n\t\t\tnext(err);\n\t\t});\n\n\t});\n\n\t// Load other posts\n\tview.on('init', function (next) {\n\n\t\tvar q = keystone.list('Post').model.find().where('state', 'published').sort('-publishedDate').populate('author').limit('4');\n\n\t\tq.exec(function (err, results) {\n\t\t\tlocals.data.posts = results;\n\t\t\tnext(err);\n\t\t});\n\n\t});\n\n\t// Render the view\n\tview.render('post');\n};\n"]}